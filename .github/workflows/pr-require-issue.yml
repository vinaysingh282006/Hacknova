name: Require Issue Reference in PR

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Check for issue reference
        uses: actions/github-script@v7
        with:
          script: |
            const prBody = context.payload.pull_request.body || "";

            // Regex to match issue references like #12, Fixes #12, Close #12
            const issueRegex = /(close[sd]?|fix(e[sd])?|resolve[sd]?)?\s*#\d+/i;

            if (!issueRegex.test(prBody)) {
              // Comment on PR
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: `❌ **Invalid Pull Request**

Thank you for your contribution.

This PR does not reference any issue.

### What you need to do:
1. Please create an issue first describing the problem or feature.
2. Then update this PR description and mention the issue number.

Use one of the following formats:
- \`Fixes #ISSUE_NUMBER\`
- \`Close #ISSUE_NUMBER\`
- \`Resolves #ISSUE_NUMBER\`

❗ PRs without a linked issue will be considered **invalid** and may be closed by maintainers.`
              });

              core.setFailed("PR does not reference any issue.");
            }
